window.setTracker=function(e){"use strict";window.addEventListener("load",function(){!function(e){function r(r){var t=r.target.tagName,a=r.target.src;if(!s.checkCrossOrigin(a,e.resource.exclude||!e.resource))return!0;if("load"===r.type){if(e.resource.log.crossOrigin&&s.checkCrossOrigin(a,e.resource.origin)){var n=s.composeResourceErrorData("CROSS ORIGIN",t,a);o("RESOURCE",n)}}else"error"===r.type&&e.resource.log.error&&o("RESOURCE",n=s.composeResourceErrorData(r.message,t,a))}function t(r){var t=r.target;if(!s.checkCrossOrigin(t.tracker._request_url,e.xhr.exclude)||!e.xhr)return!0;if("readystatechange"===r.type){var a=["_time_init","_time_open","_time_send","_time_load","_time_done"];if(a[t.readyState]&&(t.tracker[a[t.readyState]]=s.getTime()),4===t.readyState){t.tracker._response_data=t.responseText,t.tracker._status=t.status;var n=s.calculateTrackerTiming(t.tracker);if(e.xhr.log.crossOrigin&&s.checkCrossOrigin(t.tracker._request_url,e.xhr.origin)){var i=s.composeXHRErrorData("CORSS ORIGIN",t.tracker._request_url,{status:t.tracker._status,response:t.tracker._response_data},n);o("XHR",i)}e.xhr.log.slowRequest&&s.checkTimingSlow(n,e.xhr.timeLimit)&&o("XHR",i=s.composeXHRErrorData("SLOW REQUEST",t.tracker._request_url,{status:t.tracker._status,response:t.tracker._response_data},n))}}else"error"===r.type?(t.tracker._response_data=t.responseText,t.tracker._status=t.status,e.xhr.log.error&&o("XHR",i=s.composeXHRErrorData("ERROR",t.tracker._request_url,{status:t.tracker._status,response:t.tracker._response_data},n))):"timeout"===r.type&&(t.tracker._response_data=t.responseText,t.tracker._status=t.status,e.xhr.log.timeout&&o("XHR",i=s.composeXHRErrorData("TIMEOUT",t.tracker._request_url,{status:t.tracker._status,response:t.tracker._response_data},n)))}function o(e,r){var t=s.composeTrackerData(e,r);window.setTimeout(function(){t.currentURL=s.getCurrentURL(),t.userAgent=s.getUserAgent(),a(s.composeTrackerData(t))},0)}function a(r){var t=JSON.stringify(r);console.log(t);var o=new window.XMLHttpRequest;o.open("POST",e.endpoint,!0),o.send(t)}var n=window.XMLHttpRequest;window.XMLHttpRequest.prototype.tracker={_time_init:0,_time_open:0,_time_send:0,_time_load:0,_time_done:0,_request_method:"",_request_url:"",_response_data:"",_status:""},window.XMLHttpRequest=function(){var e=new n;return e._tracker_open=e.open,e.addEventListener("error",t),e.addEventListener("timeout",t),e.addEventListener("readystatechange",t),e.open=function(r,t,o,a,n){return e.tracker._request_method=r,e.tracker._request_url=t,e._tracker_open(r,t,o,a,n)},e};var s={getTime:function(){return(new Date).getTime()},getUserAgent:function(){return window.navigator.userAgent},getCurrentURL:function(){return window.location.href},checkCrossOrigin:function(e,r){if(e&&r){for(var t=!1,o=0;o<r.length;o++)e.match(r[o])&&(t|=!0);return!t}return!1},checkTimingSlow:function(e,r){return!!r&&(e.send>r.sned&&r.sned>0||e.load>r.load&&r.load>0||e.total>r.total&&r.total>0)},calculateTrackerTiming:function(e){if(e._time_load&&e._time_send&&e._time_done){var r=e._time_load-e._time_send,t=e._time_done-e._time_load;return{send:r,load:t,total:r+t}}return{send:0,load:0,total:0}},composeTrackerData:function(e,r){return{type:e,data:r}},composeScriptErrorData:function(e,r,t,o,a){return a=a&&a.stack?a.stack.toString():"",{message:e,detail:{file:r,line:t,column:o,trace:a}}},composeXHRErrorData:function(e,r,t,o){return{message:e,detail:{request:r,response:t,timing:o}}},composeResourceErrorData:function(e,r,t){return{message:e,detail:{tagname:r,resourceURL:t}}}};window.addEventListener("error",function(r){var t=s.composeScriptErrorData(r.message,r.filename,r.lineno,r.colno,r.error);s.checkCrossOrigin(r.filename,e.script.exclude||!e.script)||o("SCRIPT",t)},!0),document.addEventListener("error",r,!0),document.addEventListener("load",r,!0)}(e)})},window.setTracker({endpoint:"",xhr:{log:{crossOrigin:!0,slowRequest:!0,timeout:!0,error:!0},origin:[],timeLimit:{send:0,load:0,total:0},exclude:[]},resource:{log:{crossOrigin:!0,error:!0},origin:[],exclude:[]},script:{log:{error:!0},exclude:[]}});
//# sourceMappingURL=tracker.min.js.map